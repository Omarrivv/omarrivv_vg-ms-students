pipeline {
    agent any
    
    stages {
        stage('ğŸ§ª Test Slack Final') {
            steps {
                echo "Probando Slack con token correcto..."
                
                script {
                    try {
                        slackSend(
                            channel: '#jenkins-ci-cd-bot',
                            color: 'good',
                            message: """
ğŸ‰ *Â¡JENKINS + SLACK FUNCIONANDO!* 
â° Fecha: ${new Date().format('dd/MM/yyyy HH:mm:ss')}
âœ… Token: Correcto y actualizado
ğŸ¤– Bot: lab_jeankins conectado
ğŸ¢ Workspace: vallegrande
ğŸ”§ Build: #${env.BUILD_NUMBER}

Â¡Por fin funciona! ğŸš€
                            """,
                            teamDomain: 'vallegrande',
                            tokenCredentialId: 'slack-token'
                        )
                        echo "âœ… Â¡Mensaje enviado exitosamente a Slack!"
                    } catch (Exception e) {
                        echo "âŒ Error: ${e.getMessage()}"
                        error "Slack notification failed: ${e.getMessage()}"
                    }
                }
            }
        }
        
        stage('ğŸ”§ SimulaciÃ³n Build') {
            steps {
                echo "âš™ï¸ Simulando build..."
                sleep 2
                
                slackSend(
                    channel: '#jenkins-ci-cd-bot',
                    color: 'good',
                    message: "âœ… *BUILD COMPLETADO* - Todo funcionando perfectamente!",
                    teamDomain: 'vallegrande',
                    tokenCredentialId: 'slack-token'
                )
            }
        }
    }
    
    post {
        success {
            slackSend(
                channel: '#jenkins-ci-cd-bot',
                color: 'good',
                message: """
ğŸŠ *PIPELINE COMPLETADO EXITOSAMENTE* ğŸŠ

ğŸ¯ Test de integraciÃ³n Slack + Jenkins: âœ… EXITOSO
ğŸ“± Notificaciones funcionando correctamente
âš¡ Sistema listo para CI/CD completo

Â¡Ahora podemos proceder con el pipeline principal! ğŸš€
                """,
                teamDomain: 'vallegrande',
                tokenCredentialId: 'slack-token'
            )
        }
        failure {
            slackSend(
                channel: '#jenkins-ci-cd-bot',
                color: 'danger',
                message: "âŒ *TEST FALLIDO* - Revisar configuraciÃ³n de Slack",
                teamDomain: 'vallegrande',
                tokenCredentialId: 'slack-token'
            )
        }
    }
}